version: "3.8"

services:
  postgres:
    image: postgres:14
    container_name: conduktor-postgres
    environment:
      POSTGRES_DB: conduktor
      POSTGRES_USER: conduktor
      POSTGRES_PASSWORD: conduktor
    volumes:
      - pgdata:/var/lib/postgresql/data

  conduktor:
    image: conduktor/conduktor-platform:latest
    container_name: conduktor
    depends_on:
      - postgres
    ports:
      - "8080:8080"
    environment:
      CDK_DATABASE_URL: "postgresql://conduktor:conduktor@postgres:5432/conduktor"

      CDK_ORGANIZATION_NAME: "local-org"
      CDK_ADMIN_EMAIL: "admin@local.io"
      CDK_ADMIN_PASSWORD: "admin123"

      # --- Confluent Cloud Cluster Config ---
      CDK_CLUSTERS_0_ID: "local-id"
      CDK_CLUSTERS_0_NAME: "local-cluster"
      CDK_CLUSTERS_0_BOOTSTRAPSERVERS: "pi-home-01:9092"
      CDK_CLUSTERS_0_SECURITY_PROTOCOL: "SASL_PLAINTEXT"
      CDK_CLUSTERS_0_SASL_MECHANISM: "PLAIN"
      CDK_CLUSTERS_0_SASL_USERNAME: "admin"
      CDK_CLUSTERS_0_SASL_PASSWORD: "admin"

volumes:
  pgdata: